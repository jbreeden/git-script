<form>
  <label>Git Activity</label>
  <row>
    <panel>
      <chart>
        <title>Commits Past 30 Days</title>
        <search>
          <query>index=git kind=*commit earliest=-30d | stats count</query>
          <earliest>0</earliest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.enabled">false</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">radialGauge</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.chart.rangeValues">[0,"500",1000,"1500","2000","2500"]</option>
        <option name="charting.gaugeColors">[0x84E900,0xc2da8a,0xfac61d,0xf7912c,0xd13b3b]</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <input type="text" token="branch_name" searchWhenChanged="true">
        <label>Branch Name</label>
        <seed>*</seed>
      </input>
      <table>
        <title>Diverging Branches</title>
        <search>
          <query>index=git kind=ref-head
| where (head != merge_base)
| rename head as head_sha merge_base as merge_base_sha
| join type=left head_sha [ search index=git kind=*commit | fields sha committer_date | rename * AS head_* ]
| join type=left merge_base_sha [ search index=git kind=*commit | fields sha committer_date | rename * AS merge_base_* ]
| eval merge_base_epoch = strptime(merge_base_committer_date, "%Y-%m-%d %H:%M:%S %Z")
| eval "Branch Age"=tostring(strptime(head_committer_date, "%Y-%m-%d %H:%M:%S %Z") - merge_base_epoch, "duration")
| eval master_epoch = [search index=git ref="*/origin/develop" | join head [search index=git kind=*commit | rename sha as head] | fields committer_date | eval committer_date = strptime(committer_date, "%Y-%m-%d %H:%M:%S %Z") | rename committer_date as search]
| eval "Master Age" = tostring(master_epoch - merge_base_epoch, "duration")
| rename ref as Branch head_committer_date as "Last Commit" merge_base_committer_date as "Merge Base"
| table Branch "Merge Base" "Last Commit" "Branch Age" "Master Age"</query>
          <earliest>0</earliest>
          <latest></latest>
        </search>
        <option name="wrap">false</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <input type="text" token="author" searchWhenChanged="true">
        <label>Author</label>
        <seed>*</seed>
      </input>
      <input type="text" token="title_text" searchWhenChanged="true">
        <label>Title</label>
        <seed>*</seed>
      </input>
      <table>
        <title>Commit Log</title>
        <search>
          <query>index=git kind=*commit title="*$title_text$*" author_name="*$author$*" | rename sha AS Commit author_name AS Name author_date as Time title AS Title | sort -Time | table Time Name Commit Title</query>
          <earliest>0</earliest>
        </search>
        <option name="wrap">false</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <table>
        <title>Most Epic Day (Past 30 Days)</title>
        <search>
          <query>index=git kind=*commit    | eval day = strftime(strptime(author_date, "%Y-%m-%d %H:%M:%S %Z"),"%Y-%m-%d")    | eval top_author_day = 'author_name' . "_" . 'author_email' . "_" . 'day'    | search [       search index=git kind=*commit earliest=-30d          | eval day = strftime(strptime(author_date, "%Y-%m-%d %H:%M:%S %Z"),"%Y-%m-%d")          | eval author_day = 'author_name' . "_" . 'author_email' . "_" . 'day'          | stats count AS "commits" first(author_day) AS top_author_day by author_day          | sort -commits | head 1 | fields top_author_day ]   | rename author_date AS "Date"   | rename author_name AS "Name"   | rename sha AS "Commit"   | rename title AS "Title"   | table Date Name Commit Title</query>
        </search>
        <option name="wrap">false</option>
        <option name="rowNumbers">false</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="count">15</option>
      </table>
    </panel>
  </row>
</form>
